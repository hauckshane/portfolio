---
title: "Project 3"
author: "by: Shane Hauck"
output: 
  prettydoc::html_pretty:
    theme: cayman
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.height = 7, fig.width = 8)
```

__Introduction__

```{r}
library(knitr)
library(tidyverse)
standings <- read_csv("data/standings.csv")
standings <- standings %>% unite("team", c(team, team_name), sep = " ") %>% unite("record", c(wins, loss), sep = "-")
```

In this project I will be using data that has the standings of all NFL teams since the year 2000. The variables for this data set include:

__team__: Team city and Name.

__year__: Season year.

__record__: Wins and losses for that season.

__points_for__: Points for (offensive performance).

__points_against__: Points for (defensive performance).

__points_differential__: Point differential (points_for - points_against).

__margin_of_victory__: (Points Scored - Points Allowed)/Games Played.

__strength_of_schedule__: Average quality of opponent as measured by SRS(Simple Rating System).

__simple_rating__: Team quality relative to average(0.0) as measured by SRS. SRS = MoV + Sos = OSRS + DSRS.

__offensive_ranking__: Team offense quality relative to average (0.0) as measured by SRS.

__defensive_ranking__: Team defense quality relative to average (0.0) as measured by SRS.

__playoffs__: Made playoffs or not.

__sb_winner__: Won Superbowl or not.


Some Questions that I will be trying to answer are:

- Is it more common for a Superbowl winning team to have a good offense or good defense? 

- How much better were the Superbowl winning team's compared to the rest of the league?

- How often does the best team in the league win the Superbowl?

- What is best Superbowl winning team of all time?

- What is worst Superbowl winning team of all time?

__Content__

```{r}
bowl_winners <- standings %>% filter(sb_winner == "Won Superbowl")
  
kable(bowl_winners %>% select(c(1:2)), caption = "Superbowl Winners since 2000")
```

Above is a table of the winner of every Superbowl since the year 2000. All these teams are obviously great teams who are rightfully written down in the history books, but why these teams are great vary from year to year. Some teams were known for their lock-down defenses and others had high scoring offenses. Throughout this project I'm looking to to identify what is a more common trait for a Superbowl winning team, having a good defense or having a good offense. Along the way I want to compare how good the Superbowl winning team was compared to the rest of the league that year as well how often the best team in the league won the Superbowl. I hope that this will also help me identify what some of the best Super Bowl winning team's of the last 20 years were as well as what were some of the worst Superbowl winning teams of the last 20 years.

I am going to start my exploration by looking at the offensive stats for all the Superbowl winning teams from the past 20 years.

```{r}
bowl_offensive <- standings %>% group_by(year) %>%
  mutate(
    points_for_rank = rank(desc(points_for)),
    offensive_ranking_rank = rank(desc(offensive_ranking)),
    leauge_average_points_for = mean(points_for),
    ) %>% 
  filter(sb_winner == "Won Superbowl") %>%
  select(c(year, team, points_for, leauge_average_points_for, points_for_rank, offensive_ranking, offensive_ranking_rank))

kable(bowl_offensive, digits = 2, caption = "Offensive stats for Superbowl Winners since 2000 (ranking based on all teams from that year)")
```

When you take a close look at the table above you begin to notice that having a great offense isn't always indicative of winning a Superbowl. There actually appears to be a number of teams that had average and below average offenses compared to the rest of the league that season. That being said, there is also a fair few teams that had excellent offenses. There seems to be a trend that in the earlier years of the century it was not as common for a Superbowl winning team to have a superior offense, but in recent years (with the exception of the Broncos in 2015) having a great offense is more prevalent for Superbowl winning teams. 

```{r}
ggplot(bowl_offensive, aes(x = year)) +
  geom_line(aes(y = points_for)) +
  geom_line(aes(y = leauge_average_points_for), colour = "red") +
  labs(y = "Points For",
       x = "Year",
       title = "Points For Trend for Superbowl Winning Teams Since 2000",
       subtitle = "league average marked in red")
```

```{r}
ggplot(bowl_offensive, aes(x = year, y = offensive_ranking)) +
  geom_line() +
  geom_abline(0, slope = 0, colour = "red", size = 2) +
  labs(y = "Offensive Ranking",
       x = "Year",
       title = "Offensive Ranking Trend for Superbowl Winning Teams Since 2000",
       subtitle = "league average marked in red")
```

Like I just mentioned, the two line graphs above show a positive increase in Superbowl winning teams having a good offense since the beginning of the century. 

```{r}
ggplot(bowl_offensive, aes(x = year, y = points_for_rank)) +
  geom_point(size = 3) + 
  geom_point(aes(y = offensive_ranking_rank), size = 4, shape = 8) +
  scale_y_reverse() +
  expand_limits(y=c(0, 32)) +
  geom_hline(yintercept = 16, colour = "red") +
  facet_wrap(~team) +
  labs(y = "Rank",
       x = "Year",
       title = "Offensive Stats Ranking (ranking based on all teams from that year)",
       subtitle = "• = Points for Rank | * = Offensive Ranking")
```

In the plot above I'm looking specifically at where each teams offense ranked on a given season. Teams obviously have above average offenses but there are a select few that are below average. It appears that the worst offense in regards to the rest of the league that season was the Tampa Bay Buccaneers in 2002. As for the rest of the winners, theses offenses aren't always necessarily the best in the league on a given year. The only offense that can undoubtedly say that they were the best offense in the league their season was the New Orleans Saints in 2009. Overall though, there appears to be a lot of good but borderline great offenses that won Superbowl's. This is leading me to believe that having a great offense isn't necessary for a team to win a Superbowl.

```{r}
bowl_offensive_rank <- standings %>%
  filter(sb_winner == "Won Superbowl") %>%
  mutate(
    ranked_points_for = rank(desc(points_for)),
    ranked_offensive_ranking = rank(desc(offensive_ranking)),
    rank = rank((ranked_points_for + ranked_offensive_ranking)/2)
  ) %>%
  select(c(rank, year, team, ranked_points_for, ranked_offensive_ranking)) %>%
  arrange(rank)

kable(bowl_offensive_rank, digits = 1, caption = "Best Superbowl Winning Offenses Since 2000")
```

Above is all of the offenses ranked based on the average of where teams ranked for Points For amongst Superbowl winning teams and where they ranked for Offensive Ranking amongst Superbowl winning teams. It appears that the Saints in 2009 are considered to be the best Superbowl winning offense of the last 20 years and the 2002 Buccaneers along with the 2000 Ravens are the worst Superbowl winning offenses of all time.

I am going to continue my exploration by looking at the defensive stats for all the Superbowl winning teams from the past 20 years.

```{r}
bowl_defensive <- standings %>% group_by(year) %>%
  mutate(
    points_against_rank = rank(points_against),
    defensive_ranking_rank = rank(desc(defensive_ranking)),
    leauge_average_points_against = mean(points_against)
    ) %>% 
  filter(sb_winner == "Won Superbowl") %>%
  select(c(year, c(1:2), points_against, points_against_rank, leauge_average_points_against, defensive_ranking, defensive_ranking_rank))


kable(bowl_defensive, digits = 2, caption = "Defensive stats for Superbowl Winners since 2000 (ranking based on all teams from that year)")
```

Unlike the offensive stats, it appears that having a great defense is a common trait among Superbowl winning teams. A number of times teams were considered to be the best defensive team in the league during a given season. Only a couple of times did a team have a below average defense compared to the rest of the league that season. In more recent years it looks like teams defensive rankings are a bit lower than they were early in the 2000's. This might be caused by the recent uptick in high scoring seasons as that appears to be on the rise since the start of the century.  

```{r}
ggplot(bowl_defensive, aes(x = year)) +
  geom_line(aes(y = points_against)) +
  geom_line(aes(y = leauge_average_points_against), colour = "red") +
  labs(y = "Points Against",
       x = "Year",
       title = "Points Against Trend for Superbowl Winning Teams Since 2000",
       subtitle = "league average marked in red")
```

```{r}
ggplot(bowl_defensive, aes(x = year, y = defensive_ranking)) +
  geom_line() +
  geom_abline(0, slope = 0, colour = "red", size = 2) +
  labs(y = "Defensive Ranking",
       x = "Year",
       title = "Defensive Ranking Trend for Superbowl Winning Teams Since 2000",
       subtitle = "league average marked in red")
```

The two graphs above are starting to show that great defenses winning Superbowls might be on the decline as it appears the defenses are scored on more than in years past. Early in the century the Superbowl winning teams had total lock-down defenses, although it seems to be a little bit inconsistent from season to season, overall there has been an increase teams Points Against stat. Teams Defensive Ranking has also been on a decreasing trend since the start of the century, but this could also be compensating for teams now having better offenses, so they might be spending more money on there offenses and less money on there defenses resulting in poorer defensive play.

```{r}
ggplot(bowl_defensive, aes(x = year, y = points_against_rank)) +
  geom_point(size = 3) + 
  geom_point(aes(y = defensive_ranking_rank), size = 4, shape = 8) +
  scale_y_reverse() +
  expand_limits(y=c(0, 32)) +
  geom_hline(yintercept = 16, colour = "red") +
  facet_wrap(~team) +
  labs(y = "Rank",
       x = "Year",
       title = "Defensive Stats Ranking (ranking based on all teams from that year)",
       subtitle = "• = Points Against Rank | * = Defensive Ranking")
```

In the plot above I'm looking specifically at where each teams defense ranked on a given season. It looks like a lot of really good defenses have won Superbowls. There are a number of times where the best defense in the league has one the Superbowl and many more times where a top 10 team won the Superbowl. There do appear to be 4 occasions that teams managed to win a Superbowl with a below league average defense. The teams that did it were the Colts, the Saints, and the Giants twice. The Saints bad defense can likely be attributed to the fact they they are considered to having the best Superbowl winning offense of all time. The Colts in 2006 also had a very good offense as they were tied for 6th amongst Superbowl winning teams. But as far as the Giants go, neither time did they have a particularly impressive offense as the 2007 team was ranked 14 and the 2011 team was ranked 11.

```{r}
bowl_defensive_rank <- standings %>%
  filter(sb_winner == "Won Superbowl") %>%
  mutate(
    ranked_points_against = rank(points_against),
    ranked_defensive_ranking = rank(desc(defensive_ranking)),
    rank = rank((ranked_points_against + ranked_defensive_ranking) / 2)
  ) %>%
  select(c(rank, year, team, ranked_points_against, ranked_defensive_ranking)) %>%
  arrange(rank)

kable(bowl_defensive_rank, digits = 1, caption = "Best Superbowl Winning Defenses Since 2000")
```

Above is all of the defenses ranked based on the average of where teams ranked for Points Against amongst Superbowl winning teams and where they ranked for Defensive Ranking amongst Superbowl winning teams. The best Superbowl winning defense of all time appears to be the Tampa Bay Buccaneers in 2002 and then is followed by the Baltimore Ravens in 2000. This lines up with the trend I discussed earlier where early in the Century there were really great defenses that were winning championships. The worst Superbowl winning defense of all time is the New York Giants in 2011.

The next part of my exploration is to look at Superbowl winning teams Simple Rating which is basically a measurement of a teams overall quality, using both offensive and defensive statistics as well as teams strength of schedule and margin of victory.

```{r}
bowl_simple <- standings %>% group_by(year) %>%
  mutate(
    simple_rating_rank = rank(desc(simple_rating))
  ) %>%
  filter(sb_winner == "Won Superbowl") %>%
  select(c(year, c(1:2), simple_rating, simple_rating_rank))

kable(bowl_simple, digits = 2, caption = "Simple Rating for Superbowl Winners since 2000 (ranking based on all teams from that year)")
```

Here there appears to be a number of times where the best team in the league won the Superbowl. All teams that won are considered to be above league average teams (simple rating > 0). Looking at the table, there doesn't appear to be too much of a trend overtime in regards to an increase or decrease in how much quality a team had during a given season.

```{r}
ggplot(bowl_simple, aes(x = year)) +
  geom_line(aes(y = simple_rating)) +
  geom_abline(0, slope = 0, colour = "red", size = 2) +
  expand_limits(y = c(-3, 13)) +
  labs(y = "Simple Rating",
       x = "Year",
       title = "Simple Rating Trend for Superbowl Winning Teams Since 2000",
       subtitle = "league average marked in red")
```

```{r}
ggplot(bowl_simple, aes(x = year, y = simple_rating_rank)) +
  geom_line() +
  scale_y_reverse() +
  labs(y = "Simple Rating Rank",
       x = "Year",
       title = "Simple Rating Ranking Trend for Superbowl Winning Teams Since 2000")
```

Like I said earlier when looking at the table, there doesn't appear to be a clear trend in regards to a Superbowl winning teams simple rating overtime. For the most part teams with really high ratings won the Superbowl, but there are a small number of large drops of team that were not considered to have as much quality.

```{r}
bowl_simple_rank <- standings %>%
  filter(sb_winner == "Won Superbowl") %>%
  mutate(
    rank = rank(desc(simple_rating))
  ) %>%
  select(c(rank, year, team, simple_rating)) %>%
  arrange(rank)

kable(bowl_simple_rank, digits = 1, caption = "Best Superbowl Winning Simple Ratings Since 2000")
```

Based solely on each Superbowl winning teams Simple Rating, the 2013 Seattle Seahawks appear to be the team that is considered to have the most quality of all teams that won the Superbowl since the turn of the century. The worst team, just like with the defensive rankings, is the 2011 New York Giants.

The final thing that I am going to do for my exploratory analysis is to create a ranking of the best teams to the worst teams so I can have a final consensus on what the best and worst Superbowl winning teams of the 21st century are.

```{r}
bowl_combined <- bind_rows(bowl_offensive_rank, bowl_defensive_rank, bowl_simple_rank) %>%
  group_by(year, team) %>%
  summarise(mean_rank = mean(rank)) %>%
  ungroup() %>%
  mutate(rank = rank(mean_rank)) %>%
  arrange(rank) %>%
  select(rank, year, team, mean_rank)

kable(bowl_combined, digits = 2, caption = "Best Superbowl Winning Teams since 2000")
```

To create this rankings list I am assuming that offensive ranking, defensive ranking, and simple rating ranking are all weighted the same. I am then taking the ranking for each category, adding them all together and dividing them by 3 to receive an overall average ranking. I am then ranking the teams by the teams with the lowest average of ranks. This gave me the conclusion that the 2013 Seattle Seahawks are the best Superbowl winning team of all time. They ranked 8th for offense, tied for 3rd for defense, and was 1st for Simple Ratings. This gave them a mean ranking of 4.17 which is 0.66 lower than the second place team, the 2004 New England Patriots. The worst Superbowl winning team of all time are the 2011 New York Giants. The Giants ranked dead last in both the defensive rankings and the Simple Rating rankings, and had an offense ranked at 11. This gave them a mean ranking of 17.0 which put them lowest on the list. The team that was second lowest on the list was also the New York Giants but this time was in 2007. They had a mean ranking of 16.67. Considering that the only times the Giants won they were considered the two worst teams, it is very easy for me to conclude that the New York Football Giants are the worst team to win a Superbowl over the last 20 years.

__Conclusion__

A limitation that I had with my project was that in my final overall rankings I weighted my offensive rankings, defensive rankings, and Simple Rating rankings all evenly. In reality this might not be totally accurate. As I discussed earlier in the project I had noticed trends that offenses were scoring more and defenses were letting up more points as the years increased, this could potentially have an impact on how important an offense or defense is to a team or to the game as a whole. By saying that those rankings are equal, I'm not taking into account that having better offenses in recent years is more of a premium where as having better offenses in earlier years is more of a premium.

To wrap up this project I'm going to revisit the questions I asked at the beginning of my exploration.

- Is it more common for a Superbowl winning team to have a good offense or good defense? 

Earlier in the century it was more common for a Superbowl winning team to have a really good defense but in recent years we are seeing an uptick in great offenses winning it. I would still say that having a good defense is still more common though.

- How much better were the Superbowl winning team's compared to the rest of the league?

It is not a surprise that Superbowl winning team's are substantially better than the league average in every category, but there were a few champion teams that would be considered moderate at best.

- How often does the best team in the league win the Superbowl?

According to Simple Ratings, the best team in the league during a given season won the Superbowl 6 out of 20 times or 30% of the time.

- What is best Superbowl winning team of the last 20 year?

The best Superbowl winning team of the last 20 years is the 2013 Seattle Seahawks.

- What is worst Superbowl winning team of the last 20 years?

The worst Superbowl winning team of the last 20 years is the New York Giants, both 2007 and 2011(2011's team is slightly worse).

__Group Work__

For this project I worked individually. Sam Peacock and I bounced ideas off of each other but when it came down to actually exploring the data we both went our separate ways and did separate analysis'.

Shane Hauck

Sam Peacock